User Menu Compatibility Findings
================================

Summary
-------
- Scanned: `user_menu_init.js`, `user_menu_errors.js`, `user_menu.html`.
- Purpose: find functions/variables unused or incompatible with other modules

Findings (unused / problematic items)

could this be called by something in the newly create user profile init, but the names are mismatched?

------------------------------------
1) displayProfileAvatar(avatarUrl, firstName, lastName)
   - Issue: The `avatarUrl` parameter is never read; function uses
     `window.AvatarStore.getImage()` instead. If callers pass an avatarUrl,
     it will be ignored.
   - Impact: Unexpected behavior if callers expect the passed URL to be used.
   - Recommendation: Prefer `avatarUrl` when provided, fallback to store.

2) profile-close-btn listener (setupProfileEventListeners)
   - Issue: The code binds a click handler to element id `profile-close-btn`,
     but `user_menu.html` contains no matching element.
   - Impact: Dead code; misleading for maintainers.
   - Recommendation: Remove the lookup/listener or add the missing element to
     the template if intended.

3) settings handler in profileMenuConfig
   - Issue: Handler only contains `console.log('Settings clicked')`.
   - Impact: Placeholder behavior; users expect a settings action.
   - Recommendation: Implement settings flow or document as TODO.

4) initProfileModal idempotency
   - Issue: `initProfileModal()` uses `insertAdjacentHTML('beforeend', html)`
     without guarding; repeated calls may duplicate DOM nodes.
   - Impact: Duplicate nodes and event listeners if init is called repeatedly.
   - Recommendation: At start of init, if `#profile-dropdown` exists, return.

5) Hardcoded UI string
   - Issue: `openProfileModal()` falls back to `'User'` when name is missing.
   - Impact: Violates i18n Rule 1 (strings must come from language_strings).
   - Recommendation: Use `getString('profile.nameUnknown')` and add translations.

Compatibility notes
-------------------
- `user_menu_init.js` expects globals: `window.handleLogout`, `window.AvatarStore`,
  and `window.supabase`. Ensure these are available before calling open.
- `user_menu_init.js` references `window.showProfileGeneralError` which is
  defined in `user_menu_errors.js` (ok, but keep names stable).
- `user_menu` prefers `window.openUserProfile()`; if not present it falls
  back to `window.initEditProfileModal()`. Ensure `containers/user_profile/*`
  exports one of these, or provide aliases.

Suggested minimal code fixes (examples)
-------------------------------------
1) Use avatarUrl when present (in user_menu_init.js):

   const displayProfileAvatar = (avatarUrl, firstName, lastName) => {
     const profileAvatarEl = document.getElementById('profile-avatar');
     if (!profileAvatarEl) return;
     profileAvatarEl.innerHTML = '';
     const storeImage = window.AvatarStore && typeof window.AvatarStore.getImage === 'function'
       ? window.AvatarStore.getImage()
       : null;
     const src = avatarUrl || storeImage;
     if (src) {
       const img = document.createElement('img');
       img.src = src;
       img.alt = `${firstName || ''} ${lastName || ''}`.trim();
       profileAvatarEl.appendChild(img);
     }
   };

2) Make initProfileModal idempotent (start of function):

   if (document.getElementById('profile-dropdown')) return;

3) Replace hardcoded fallback name:

   if (nameEl) nameEl.textContent = window.getString ? window.getString('profile.nameUnknown') : 'User';

Location hints (file / approximate lines)
- `containers/user_menu/user_menu_init.js`: displayProfileAvatar (~lines 14-26),
  setupProfileEventListeners closeBtn (~lines 106-112), initProfileModal (~lines 135-145),
  openProfileModal name fallback (~lines 177-181), profileMenuConfig.settings (~lines 96-103).
- `containers/user_menu/user_menu.html`: no `profile-close-btn` element found.

Notes
-----
- I did NOT apply any code changes. Ask me to apply any of the suggested
  patches and I will make the edits (I will not commit them unless you say so).

End of findings.
